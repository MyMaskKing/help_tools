# WPS云文档任务邮件提醒工具

这是一个基于WPS云文档Python脚本功能的自动化任务提醒工具。它能够自动查询数据表中的今日待办任务，并通过HTTP POST请求将任务信息发送到指定邮箱。

## 项目结构

```
.
├── .cursor/                # Cursor IDE配置
│   └── rules/             # Cursor规则文件
├── wps/                   # WPS相关文档
│   └── 官方文档.md         # WPS API官方文档
├── config.json            # 配置文件
├── design.md             # 项目设计文档
└── README.md             # 项目说明文档
```

## 功能特点

- 自动查询当天未完成的任务
- 支持自定义数据表字段配置
- 生成美观的HTML格式邮件内容
- 通过HTTP POST请求发送邮件
- 支持163邮箱服务
- 可配置的邮件发送参数

## 系统要求

1. WPS云文档账号
2. 数据表文档，包含以下必要字段：
   - 日期字段：用于筛选当天任务
   - 任务标识字段：用于标记任务（值为1表示是任务）
   - 完成状态字段：用于筛选未完成任务（值为0表示未完成）
   - 今天要做什么事：记录任务的具体内容
   - 当前数据的链接：任务相关的链接

## 配置说明

在`config.json`文件中配置以下参数：

```json
{
  "email": {
    "smtp_server": "",    // SMTP服务器地址
    "smtp_port": 465,     // SMTP端口
    "smtp_user": "",      // SMTP用户名
    "smtp_password": "",  // SMTP密码
    "to_addr": ""         // 收件人邮箱
  },
  "query": {
    "field_names": {
      "task_name": "今天要做什么事",    // 任务名称字段
      "task_link": "当前数据的链接"     // 任务链接字段
    },
    "conditions": {
      "date_field": "日期",            // 日期字段
      "task_flag_field": "任务标识",    // 任务标识字段
      "completion_field": "完成状态"    // 完成状态字段
    }
  }
}
```

## 使用方法

1. 在WPS云文档中打开您的数据表文件
2. 选择顶部菜单的"效率" > "PY脚本"（在表格或智能表格中）或"脚本" > "PY脚本"（在多维表格中）
3. 创建新脚本
4. 将脚本内容复制到编辑器中
5. 根据实际需求修改`config.json`中的配置
6. 运行脚本

## 脚本功能说明

1. 数据查询
   - 使用`dbt()`函数查询数据表
   - 自动筛选当天未完成的任务
   - 支持自定义查询条件

2. 邮件生成
   - 将查询结果格式化为HTML
   - 包含任务列表和链接
   - 支持自定义邮件模板

3. 邮件发送
   - 通过HTTP POST请求发送邮箱服务器
   - 支持mainTo设置
   - 可配置发送参数

## 注意事项

- 确保数据表字段名称与配置文件中的设置一致
- 邮件发送使用HTTP POST请求，目前是发送到Make
- 建议定期检查脚本运行状态
- 请妥善保管邮箱配置信息

## 开发规范

- 遵循PEP 8编码规范
- 使用类型注解
- 添加必要的注释和文档
- 进行异常处理和日志记录

## 更新日志

### v1.0.0 (2024-05-16)
- 初始版本发布
- 支持基本的任务查询和邮件发送功能
- 提供配置文件支持

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

MIT License